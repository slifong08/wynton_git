#20240105
# Sarah Fong

# ATAC peak processing and EDA for DNN genomic modeling of ultrasound response. 

    There are 4 cell lines with ATAC-seq narrowpeaks (called from MACS2, presumably have q<0.05) in two conditions—ultrasound exposed and unexposed (i.e."ctrl")—in triplicates. In total this is 24 files. 

    ** filtering peaks **

        To call stringent peaks in each dataset, I'm going to filter for a q <0.0001 and will also require that peaks have a score >=100. The q and score thresholds are arbitrary. They can be tested at different thresholds for consistency of results. This resulted in replicates with 16755 - 80778 peaks called per dataset. There was no obvious difference in the number of peaks between replicates, though there was an obvious difference in the number of peaks called between cell types (HOB>K562>BJ>HepG2). Generally, it appears that mean accessibility decreasesd for every cell line except k562 when exposed to ultrasound. 

        # replicate ranges for each cell line (cl), exposure (Control or Treated)
        cl 	    exp    min 	max		
        BJ 	    C 	17364.0 	53045.0
                T 	23396.0 	52325.0
        HEPG2 	C 	18469.0 	40444.0
                T 	16755.0 	22017.0
        HOB 	C 	52746.0 	80778.0
                T 	58578.0 	73200.0
        K562 	C 	43192.0 	53593.0
                T 	48034.0 	52592.0

    ** consensus peaks across replicates **
    To call consensus peaks, I will use a multiinter function from bedtools, then back-intersect the multi intersect across each of the replicates to get raw and quantile normalized scores for each peak. One caveat is that consensus peak should be smaller than individual replicate peaks. One issue is that the overlap between peaks might be very small (1bp). In that case, I will need to set a minimum peak length to select for peaks that robustly overlap. Usually this would be carried out with the -f or fraction argument, but that cannot be implemented here. In the back-intersect, I would be able to use the -f argument to insure that the multi intersect argument overlaps each replicate peak with 50%